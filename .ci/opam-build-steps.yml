# Shared steps for building OPAM projects

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '8.9'
  - script: opam init --auto-setup --dot-profile=~/.bash_profile
    displayName: 'opam init'
  - script: opam remote add ocamlorg https://opam.ocaml.org || true
    displayName: 'opam remote add ocamlorg'
  - script: opam remove default || true
    displayName: 'opam remove default'
  - script: opam update
    displayName: 'opam update'
  - script: opam install -y dune
    displayName: 'opam install -y dune'
  - script: opam install -y menhir
    displayName: 'opam install -y menhir'
  - script: opam install -y utop
    displayName: 'opam install -y utop'
  - script: make clean-for-ci
    displayName: 'make clean-for-ci'
